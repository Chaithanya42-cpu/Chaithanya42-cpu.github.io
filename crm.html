<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CRM Tracker — Clean Notes</title>
  <style>
    :root{--bg:#f7f9fb;--card:#ffffff;--muted:#6b7280;--accent:#2563eb;--border:rgba(15,23,42,0.06)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:var(--bg);color:#0f1724}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--border);background:var(--card)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:40px;border-radius:8px;background:linear-gradient(135deg,#60a5fa,#7c3aed);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    .title{font-size:16px;font-weight:600}
    .layout{display:grid;grid-template-columns:320px 280px 1fr;gap:18px;max-width:1400px;margin:20px auto;padding:0 16px}
    .panel{background:var(--card);border-radius:12px;padding:12px;height:calc(100vh - 120px);overflow:auto;border:1px solid var(--border)}
    .main{min-height:calc(100vh - 120px)}
    .search{display:flex;gap:8px;margin-bottom:10px}
    .search input{flex:1;padding:9px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{background:transparent;border:1px solid var(--border);padding:10px 12px;border-radius:8px;color:var(--muted);text-align:left;cursor:pointer}
    .menu button.active{background:linear-gradient(90deg,rgba(37,99,235,0.06),rgba(124,58,237,0.03));border-color:rgba(37,99,235,0.16);color:#0b2447}
    .submenu-list{display:flex;flex-direction:column;gap:6px}
    .subitem{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;text-align:left}
    .subitem.active{background:rgba(37,99,235,0.08);color:#0b2447;border-color:rgba(37,99,235,0.12);font-weight:600}
    .small{font-size:13px;color:var(--muted)}
    textarea{width:100%;height:calc(100vh - 220px);padding:14px;border-radius:10px;border:1px solid var(--border);background:transparent;color:inherit;font-size:15px;line-height:1.5;resize:vertical}
    footer{padding:14px 24px;color:var(--muted);font-size:13px;text-align:center}
    @media (max-width:1100px){.layout{grid-template-columns:1fr 300px;}.submenu{display:none}}
    @media (max-width:700px){.layout{grid-template-columns:1fr;}.panel{height:auto}}
    .actions{display:flex;gap:8px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">CT</div>
      <div>
        <div class="title">CRM Tracker — Clean Notes</div>
        <div class="small">Main menu → sub-menu → notepad. Notes auto-save locally.</div>
      </div>
    </div>
    <div class="small">Storage: <strong id="storageInfo">localStorage</strong></div>
  </header>

  <div class="layout">
    <aside class="panel">
      <div class="search"><input id="searchInput" placeholder="Filter categories..." /></div>
      <div class="small" style="margin-bottom:8px">Categories</div>
      <div class="menu" id="menuList"></div>
      <div class="actions">
        <button id="exportAll">Export</button>
        <button id="importBtn">Import</button>
      </div>
    </aside>

    <aside class="panel" id="submenuPane">
      <div class="small" style="margin-bottom:8px">Sub-Menu</div>
      <div id="submenuList" class="submenu-list"></div>
      <div class="actions">
        <button id="addSub">Add</button>
        <button id="removeSub">Remove</button>
      </div>
    </aside>

    <main class="panel main">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div id="pageTitle" style="font-size:18px;font-weight:600">Designs</div>
          <div id="pageSubtitle" class="small">Select a sub-item to open its notepad.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="saveBtn">Save</button>
          <button id="clearBtn">Clear</button>
        </div>
      </div>

      <div style="margin-top:14px">
        <label class="small">Notes</label>
        <textarea id="noteArea" placeholder="Type notes for the selected category → sub-item (auto-saved)"></textarea>
      </div>
    </main>
  </div>

  <footer>CRM Tracker — local notes. Export/Import to move data between devices.</footer>

  <script>
    // Main categories and submenus
    const categories = [
      'Channels','Purpose','Journey Type','References',
      'Designs','Copies','Templates','Getting Approval from Client',
      'Client Segments','Campaign/Journeys Analysis','Campaign Execution',
      'RFM','Cohort','Funnel','Metrics','A/B Testing','Flow Analysis','NPS',
      'Technical Issues','Technical Advantages',
      'Note Taking','Planning'
    ];

    const defaultSubsections = {
      'Channels': ['Email','SMS','WhatsApp','Push','In-app','Web'],
      'Purpose': ['Event','Educational','Offer','Transactional','Retention','Other'],
      'Journey Type': ['All','Special Events','Welcome','Abandonment','Re-engagement','Lifecycle'],
      'References': ['Research Academies','ChatGPT','YouTube','Customer Care'],

      'Designs': ['Channels & Types','Purpose','Journey Types','Overview','References'],
      'Copies': ['Channels & Types','Purpose','Journey Types','Variants','Overview'],
      'Templates': ['Email','SMS/WhatsApp','Push','In-app','Overview'],
      'Getting Approval from Client': ['Copy','Design','Strategy','Approvals Log','Comments'],
      'Client Segments': ['RFM Segments','Cohort Segments','Funnel Segments','Test Segments','Notes'],
      'Campaign/Journeys Analysis': ['Benchmarks','Historical Data','Metrics','Insights','Recommendations'],
      'Campaign Execution': ['Pre-checklist','Execution Checklist','Post-checklist','Issues','Notes'],
      'RFM': ['Summary','Segments','Actions','Notes','Results'],
      'Cohort': ['Weekly','Monthly','Retention Notes','Actions','Results'],
      'Funnel': ['Top','Middle','Bottom','Drop-offs','Fixes'],
      'Metrics': ['Conversions','Engagement','Revenue','Custom Metrics','Notes'],
      'A/B Testing': ['Hypotheses','Variants','Results','Learnings','Notes'],
      'Flow Analysis': ['Flow Map','Drop-offs','Optimizations','Notes','Results'],
      'NPS': ['Responses','Promoters','Detractors','Actions','Trends'],
      'Technical Issues': ['Open','In Progress','Resolved','Logs','Notes'],
      'Technical Advantages': ['Ideas','Integrations','Automations','Notes','Results'],

      // New single-notepad categories
      'Note Taking': ['Notes'],
      'Planning': ['Notes']
    };

    // DOM refs
    const menuList = document.getElementById('menuList');
    const submenuList = document.getElementById('submenuList');
    const pageTitle = document.getElementById('pageTitle');
    const noteArea = document.getElementById('noteArea');
    const saveBtn = document.getElementById('saveBtn');
    const clearBtn = document.getElementById('clearBtn');
    const searchInput = document.getElementById('searchInput');
    const addSub = document.getElementById('addSub');
    const removeSub = document.getElementById('removeSub');
    const exportAllBtn = document.getElementById('exportAll');
    const importBtn = document.getElementById('importBtn');

    const STORAGE_KEY = 'crm_tracker_notes_v1';

    let state = {
      selectedCategory: categories[0],
      selectedSub: (defaultSubsections[categories[0]] && defaultSubsections[categories[0]][0]) || 'Notes',
      data: {} // {category:{sub:{text:''}}}
    };

    function loadFromStorage(){
      try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw) state.data = JSON.parse(raw); }catch(e){console.error(e)}
    }
    function saveToStorage(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state.data)); flashSaved(); }catch(e){console.error(e)} }
    function flashSaved(){ pageTitle.style.opacity=0.6; setTimeout(()=>pageTitle.style.opacity=1,300); }

    function renderMenu(filter=''){
      menuList.innerHTML='';
      categories.filter(c=>c.toLowerCase().includes(filter.toLowerCase())).forEach(cat=>{
        const btn = document.createElement('button'); btn.textContent=cat; btn.className = cat===state.selectedCategory? 'active':'';
        btn.onclick = ()=>{ selectCategory(cat); };
        menuList.appendChild(btn);
      });
    }

    function renderSubmenu(){
      submenuList.innerHTML='';
      const subs = defaultSubsections[state.selectedCategory] || ['Notes'];
      subs.forEach(s=>{
        const div = document.createElement('div'); div.className='subitem'; div.textContent=s;
        if(s===state.selectedSub) div.classList.add('active');
        div.onclick = ()=>{ selectSub(s); };
        submenuList.appendChild(div);
      });
    }

    function selectCategory(cat){
      state.selectedCategory = cat;
      const subs = defaultSubsections[cat] || ['Notes'];
      state.selectedSub = subs[0];
      pageTitle.textContent = cat + ' — ' + state.selectedSub;
      renderMenu(searchInput.value);
      renderSubmenu();
      loadNote();
    }

    function selectSub(sub){ state.selectedSub = sub; pageTitle.textContent = state.selectedCategory + ' — ' + state.selectedSub; renderSubmenu(); loadNote(); }

    function getCurrentObj(){
      if(!state.data[state.selectedCategory]) state.data[state.selectedCategory] = {};
      if(!state.data[state.selectedCategory][state.selectedSub]) state.data[state.selectedCategory][state.selectedSub] = {text:''};
      return state.data[state.selectedCategory][state.selectedSub];
    }

    function loadNote(){ const obj = getCurrentObj(); noteArea.value = obj.text || ''; }
    function saveCurrent(){ const obj = getCurrentObj(); obj.text = noteArea.value; saveToStorage(); }

    noteArea.addEventListener('input', debounce(saveCurrent,700));
    saveBtn.onclick = saveCurrent;

    clearBtn.onclick = ()=>{ if(confirm('Clear notes for "'+state.selectedCategory+' / '+state.selectedSub+'"?')){ if(state.data[state.selectedCategory]) delete state.data[state.selectedCategory][state.selectedSub]; noteArea.value=''; saveToStorage(); } }

    addSub.onclick = ()=>{ const name = prompt('New sub-item name'); if(!name) return; const arr = defaultSubsections[state.selectedCategory] || []; arr.push(name); defaultSubsections[state.selectedCategory]=arr; renderSubmenu(); selectSub(name); }
    removeSub.onclick = ()=>{ if(!confirm('Remove sub-item "'+state.selectedSub+'" from '+state.selectedCategory+'?')) return; const arr = defaultSubsections[state.selectedCategory] || []; defaultSubsections[state.selectedCategory] = arr.filter(x=>x!==state.selectedSub); if(state.data[state.selectedCategory]) delete state.data[state.selectedCategory][state.selectedSub]; const newSub = (defaultSubsections[state.selectedCategory] && defaultSubsections[state.selectedCategory][0]) || 'Notes'; selectSub(newSub); saveToStorage(); }

    exportAllBtn.onclick = ()=>{ const dataStr = JSON.stringify(state.data,null,2); const blob = new Blob([dataStr],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='crm_tracker_notes.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
    importBtn.onclick = ()=>{ const input = document.createElement('input'); input.type='file'; input.accept='application/json'; input.onchange = e=>{ const file = e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=ev=>{ try{ const imported = JSON.parse(ev.target.result); state.data = Object.assign({}, state.data, imported); saveToStorage(); alert('Import successful'); }catch(err){ alert('Invalid JSON'); } }; reader.readAsText(file); }; input.click(); }

    function debounce(fn,ms){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,arguments),ms); }; }

    searchInput.addEventListener('input', (e)=>{ renderMenu(e.target.value); });
    document.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key==='s'){ e.preventDefault(); saveCurrent(); } });

    // initial
    loadFromStorage(); renderMenu(); renderSubmenu(); selectCategory(state.selectedCategory);
    document.getElementById('storageInfo').textContent = STORAGE_KEY + ' (localStorage in this browser)';
  </script>
</body>
</html>
